<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Snake</title>
<style>
    body {
        margin: 0;
        background: black;
        color: white;
        font-family: Arial;
        text-align: center;
    }
    canvas {
        display: block;
        margin: 10px auto;
        background: black;
        border: 2px solid #0f0;
    }
</style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>

<script>
/* ===== CONFIG ===== */
var TILE = 20;
var SIZE = 400;
var HALF = SIZE / 2;
var SPEED = 120;

/* ===== CANVAS ===== */
var canvas = document.getElementById("game");
var ctx = canvas.getContext("2d");

/* ===== GAME STATE ===== */
var px = 0, py = 0;
var facing = "up";
var nextFacing = "up";
var canTurn = true;

var segments = [];
var startLen = 4;

var bx = randPos();
var by = randPos();

var score = 0;
var highscore = 0;
var menu = 1;
var loop = null;

/* ===== HELPERS ===== */
function randPos() {
    return (Math.floor(Math.random() * 19) - 9) * TILE;
}

function drawRect(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(
        x + HALF,
        HALF - y - TILE,
        TILE,
        TILE
    );
}

/* ===== RESET ===== */
function resetGame() {
    px = 0;
    py = 0;
    facing = "up";
    nextFacing = "up";
    score = 0;
    segments = [];

    for (var i = 0; i < startLen; i++) {
        segments.push({ x: 0, y: 0 });
    }

    bx = randPos();
    by = randPos();
}

/* ===== DRAW ===== */
function drawSnake() {
    drawRect(px, py, "green");
    for (var i = 0; i < segments.length; i++) {
        drawRect(segments[i].x, segments[i].y, "#006600");
    }
}

function drawBerry() {
    drawRect(bx, by, "red");
}

function drawUI() {
    ctx.fillStyle = "white";
    ctx.font = "14px Arial";
    ctx.fillText("Score: " + score, 8, 18);
    ctx.fillText("High: " + highscore, 8, 34);

    ctx.strokeStyle = "#0f0";
    ctx.strokeRect(0, 0, SIZE, SIZE);
}

function drawMenu() {
    ctx.clearRect(0, 0, SIZE, SIZE);
    ctx.fillStyle = "red";
    ctx.font = "18px Arial";
    ctx.fillText("Snake", 170, 180);
    ctx.font = "14px Arial";
    ctx.fillText("Press SPACE or click", 120, 210);
}

/* ===== GAME LOGIC ===== */
function moveSnake() {
    canTurn = true;
    facing = nextFacing;

    segments.unshift({ x: px, y: py });

    if (facing === "up") py += TILE;
    if (facing === "down") py -= TILE;
    if (facing === "left") px -= TILE;
    if (facing === "right") px += TILE;

    if (px === bx && py === by) {
        score++;
        if (score > highscore) highscore = score;
        bx = randPos();
        by = randPos();
    } else {
        segments.pop();
    }

    for (var i = 0; i < segments.length; i++) {
        if (px === segments[i].x && py === segments[i].y) gameOver();
    }

    if (px >= 200 || px <= -200 || py >= 200 || py <= -200) gameOver();
}

function gameOver() {
    clearInterval(loop);
    menu = 1;
    drawMenu();
}

/* ===== LOOP ===== */
function tick() {
    ctx.clearRect(0, 0, SIZE, SIZE);
    moveSnake();
    drawBerry();
    drawSnake();
    drawUI();
}

/* ===== CONTROLS ===== */
function setDir(dir, opposite) {
    if (canTurn && facing !== opposite) {
        nextFacing = dir;
        canTurn = false;
    }
}

document.addEventListener("keydown", function (e) {
    var k = e.key.toLowerCase();

    if (menu && k === " ") startGame();

    if (k === "arrowup" || k === "w") setDir("up", "down");
    if (k === "arrowdown" || k === "s") setDir("down", "up");
    if (k === "arrowleft" || k === "a") setDir("left", "right");
    if (k === "arrowright" || k === "d") setDir("right", "left");

    if (k === "q") rotateLeft();
    if (k === "e") rotateRight();
});

canvas.addEventListener("click", function (e) {
    if (menu) {
        startGame();
        return;
    }
    if (e.offsetX < SIZE / 2) rotateLeft();
    else rotateRight();
});

function rotateLeft() {
    if (!canTurn) return;
    var map = { up: "left", left: "down", down: "right", right: "up" };
    nextFacing = map[facing];
    canTurn = false;
}

function rotateRight() {
    if (!canTurn) return;
    var map = { up: "right", right: "down", down: "left", left: "up" };
    nextFacing = map[facing];
    canTurn = false;
}

/* ===== START ===== */
function startGame() {
    resetGame();
    menu = 0;
    loop = setInterval(tick, SPEED);
}

drawMenu();
</script>

</body>
</html>
